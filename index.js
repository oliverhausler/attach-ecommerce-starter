var pages = [
	{
		photo: {
			name: 'Sports Suit',
			url: 'https://dev-assets.attach.live/unsplash/dom-hill-512919.jpg',
			credits: 'Photographer: Dom Hill',
			price: 29.95,
		},
		properties: {
			'attach:room':
				'https://attach-live.github.io/attach-ecommerce-starter/sports-suit',
			'attach:videocall:button-background-color': '#1e4aea',
			'attach:videocall:remote-background-color': '#ffc730',
			'attach:videocall:local-background-color': '#ffc730',
			'attach:chat:viewer-background-color': '#ffffff',
			'attach:chat:editor-background-color': '#ffffff',
		},
	},
	{
		photo: {
			name: 'Fluffy Dress',
			url: 'https://dev-assets.attach.live/unsplash/shawn-fields-1192055.jpg',
			credits: 'Photographer: Shawn Fields',
			price: 18.95,
		},
		properties: {
			'attach:room':
				'https://attach-live.github.io/attach-ecommerce-starter/fluffy-dress',
			'attach:videocall:button-background-color': '#0000c0',
			'attach:videocall:remote-background-color': '#002ade',
			'attach:videocall:local-background-color': '#ffffff',
			'attach:chat:viewer-background-color': '#ffffff',
			'attach:chat:editor-background-color': '#0000c0',
		},
	},
	{
		photo: {
			name: 'Camouflage Sweater',
			url: 'https://dev-assets.attach.live/unsplash/alora-griffiths-800048.jpg',
			credits: 'Photographer: Alora Griffiths',
			price: 19.95,
		},
		properties: {
			'attach:room':
				'https://attach-live.github.io/attach-ecommerce-starter/camouflage-sweater',
			'attach:videocall:button-background-color': '#525252',
			'attach:videocall:remote-background-color': '#00c0ff',
			'attach:videocall:local-background-color': '#ffffff',
			'attach:chat:viewer-background-color': '#ffffff',
			'attach:chat:editor-background-color': '#99e6ff',
		},
	},
	{
		photo: {
			name: 'Snake-Skin Dress',
			url: 'https://dev-assets.attach.live/unsplash/alice-alinari-1283717.jpg',
			credits: 'Photographer: Alice Alinari',
			price: 69.95,
		},
		properties: {
			'attach:room':
				'https://attach-live.github.io/attach-ecommerce-starter/snake-skin-dress',
			'attach:videocall:button-background-color': '#dba98e',
			'attach:videocall:remote-background-color': '#965430',
			'attach:videocall:local-background-color': '#ffffff',
			'attach:chat:viewer-background-color': '#ffffff',
			'attach:chat:editor-background-color': '#965430',
		},
	},
	{
		photo: {
			name: 'Romantic Dress',
			url:
				'https://dev-assets.attach.live/unsplash/azamat-zhanisov-1281841.jpg',
			credits: 'Photographer: Azamat Zhanisov',
			price: 89.99,
		},
		properties: {
			'attach:room':
				'https://attach-live.github.io/attach-ecommerce-starter/romantic-dress',
			'attach:videocall:button-background-color': '#dbdbdb',
			'attach:videocall:remote-background-color': '#ffffff',
			'attach:videocall:local-background-color': '#ffffff',
			'attach:chat:viewer-background-color': '#ffffff',
			'attach:chat:editor-background-color': '#1221e0',
		},
	},
	{
		photo: {
			name: 'Black Dress',
			url:
				'https://dev-assets.attach.live/unsplash/azamat-zhanisov-1281840.jpg',
			credits: 'Photographer: Azamat Zhanisov',
			price: 49.95,
		},
		properties: {
			'attach:room':
				'https://attach-live.github.io/attach-ecommerce-starter/black-dress',
			'attach:videocall:button-background-color': '#352b22',
			'attach:videocall:remote-background-color': '#ff66ff',
			'attach:videocall:local-background-color': '#ffffff',
			'attach:chat:viewer-background-color': '#ffffff',
			'attach:chat:editor-background-color': '#99e6ff',
		},
	},
	{
		photo: {
			name: 'Urban Blazer Chic',
			url:
				'https://dev-assets.attach.live/unsplash/swapnil-dwivedi-1205204.jpg',
			credits: 'Photographer: Swapnil Dwivedi',
			price: 19.95,
		},
		properties: {
			'attach:room':
				'https://attach-live.github.io/attach-ecommerce-starter/urban-blazer-chic',
			'attach:videocall:button-background-color': '#0000cc',
			'attach:videocall:remote-background-color': '#e6c29b',
			'attach:videocall:local-background-color': '#ffffff',
			'attach:chat:viewer-background-color': '#ffffff',
			'attach:chat:editor-background-color': '#ffffff',
		},
	},
	{
		photo: {
			name: 'Urban Basic Suit',
			url: 'https://dev-assets.attach.live/unsplash/brunel-johnson-381896.jpg',
			credits: 'Photographer: Brunel Johnson',
			price: 50.9,
		},
		properties: {
			'attach:room':
				'https://attach-live.github.io/attach-ecommerce-starter/urban-basic-suit',
			'attach:videocall:button-background-color': '#965430',
			'attach:videocall:remote-background-color': '#84b0f4',
			'attach:videocall:local-background-color': '#ffffff',
			'attach:chat:viewer-background-color': '#ffffff',
			'attach:chat:editor-background-color': '#965430',
		},
	},
	{
		photo: {
			name: 'Street Blazer',
			url: 'https://dev-assets.attach.live/unsplash/khoman-room-578663.jpg',
			credits: 'Photographer: khoman Room',
			price: 109.9,
		},
		properties: {
			'attach:room':
				'https://attach-live.github.io/attach-ecommerce-starter/street-blazer',
			'attach:videocall:button-background-color': '#b4e0c6',
			'attach:videocall:remote-background-color': '#643720',
			'attach:videocall:local-background-color': '#ffffff',
			'attach:chat:viewer-background-color': '#ffffff',
			'attach:chat:editor-background-color': '#47ad70',
		},
	},
	{
		photo: {
			name: 'Roman Technical Suit',
			url: 'https://dev-assets.attach.live/unsplash/judeus-samson-1223214.jpg',
			credits: 'Photographer: Judeus Samson',
			price: 120.9,
		},
		properties: {
			'attach:room':
				'https://attach-live.github.io/attach-ecommerce-starter/roman-technical-suit',
			'attach:videocall:button-background-color': '#a03070',
			'attach:videocall:remote-background-color': '#dba98e',
			'attach:videocall:local-background-color': '#ffffff',
			'attach:chat:viewer-background-color': '#ffffff',
			'attach:chat:editor-background-color': '#235637',
		},
	},
	{
		photo: {
			name: 'Black Quatro Bag',
			url:
				'https://dev-assets.attach.live/unsplash/farhad-khodayari-1348907.jpg',
			credits: 'Photographer: Farhad Khodayari',
			price: 49.9,
		},
		properties: {
			'attach:room':
				'https://attach-live.github.io/attach-ecommerce-starter/black-quatro-bag',
			'attach:videocall:button-background-color': '#965430',
			'attach:videocall:remote-background-color': '#84b0f4',
			'attach:videocall:local-background-color': '#ffffff',
			'attach:chat:viewer-background-color': '#ffffff',
			'attach:chat:editor-background-color': '#965430',
		},
	},
]

function toKebabCase(value) {
	return value.toLowerCase().replace(/ /g, '-')
}

var magazine = {
	currentPage: -1,
	nextPage: function() {
		this.currentPage = (this.currentPage + 1) % pages.length
	},
	previousPage: function() {
		if (this.currentPage) {
			this.currentPage--
		} else {
			this.currentPage = pages.length - 1
		}
	},
	getPageNumber: function(hash) {
		var page = -1
		pages.forEach(function(pageInfo, i) {
			if (toKebabCase(pageInfo.photo.name) === hash) {
				page = i
			}
		})
		return page
	},
	getPageData: function() {
		return pages[this.currentPage]
	},
}

window.magazine = magazine
window.pages = pages

function updateAttach(prop, value) {
	attachSdk.setProperty(prop, value)
}

function render(pageData) {
	var leftSide = document.querySelector('#left-side')
	var price = document.querySelector('#price')
	var credits = document.querySelector('#credits')
	leftSide.style.backgroundImage = 'url("' + pageData.url + '")'
	price.innerText = pageData.price.toFixed(2)
	credits.innerText = pageData.credits
}

function nextPage() {
	magazine.nextPage()
	router.navigate(toKebabCase(magazine.getPageData().photo.name))
}

function previousPage() {
	magazine.previousPage()
	router.navigate(toKebabCase(magazine.getPageData().photo.name))
}

function onKeyUp(e) {
	if (e.which === 39) {
		nextPage()
	}
	if (e.which === 37) {
		previousPage()
	}
}

function setUpNavigationListeners() {
	document
		.querySelector('#previousButton')
		.addEventListener('click', previousPage)
	document.querySelector('#nextButton').addEventListener('click', nextPage)
	document.addEventListener('keyup', onKeyUp)
}

var landingPage = document.querySelector('#landing')
var magazinePage = document.querySelector('#pages')

var router = new Navigo(
	'https://attach-live.github.io/attach-ecommerce-starter/',
	false
)

//https://stackoverflow.com/a/5298684
function removeHash() {
	history.pushState(
		'',
		document.title,
		window.location.pathname + window.location.search
	)
}

router
	.on(':name', function(params) {
		magazinePage.style.display = 'flex'
		landingPage.style.display = 'none'
		setUpNavigationListeners()

		var pageNumber = magazine.getPageNumber(params.name)
		if (pageNumber === -1) {
			return router.navigate('/')
		}
		magazine.currentPage = pageNumber

		render(magazine.getPageData().photo)

		//Update attach properties
		Object.keys(magazine.getPageData().properties).forEach(k => {
			updateAttach(k, magazine.getPageData().properties[k])
		})
	})
	.on('*', function() {
		const pathPhoto = window.location.pathname.split('/')[2]
		if (pathPhoto) {
			return router.navigate(pathPhoto)
		}
		landingPage.style.display = 'flex'
		magazinePage.style.display = 'none'
		document.querySelector('#landing .left-side').style.backgroundImage =
			'url("' + pages[0].photo.url + '")'
		document.querySelector('#start').addEventListener('click', nextPage)
	})
	.resolve()

var mobileDetect = new MobileDetect(
	navigator.userAgent || navigator.vendor || window.opera
)
var isMobile = mobileDetect.mobile()

if (isMobile) {
	var body = document.querySelector('body')
	body.classList.add('mobile')
	if (
		mobileDetect
			.os()
			.toLowerCase()
			.indexOf('android') >= 0
	) {
		body.classList.add('android')
	}
	if (
		mobileDetect
			.os()
			.toLowerCase()
			.indexOf('ios') >= 0
	) {
		body.classList.add('ios')
	}
}
